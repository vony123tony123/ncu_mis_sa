<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author"
	content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
<meta name="generator" content="Jekyll v3.8.5">

<title>保險資訊輸入</title>

<!-- Bootstrap core CSS -->
<link href="statics/css/bootstrap.min.css" rel="stylesheet">
<link href="statics/css/font-awesome.min.css" rel="stylesheet">
<link href="statics/icon/favicon.ico" type="image/x-icon" rel="icon">
<link href="statics/icon/favicon.ico" type="image/x-icon"
	rel="shortcut icon">

<!-- Custom styles for this template -->
<link href="statics/css/product.css" rel="stylesheet">
<link href="statics/css/jquery-confirm.css" rel="stylesheet">

<script src="statics/js/jquery-3.4.1.min.js"></script>
<script src="statics/js/jquery-confirm.js"></script>
</head>
<body>

<div
		class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 border-bottom shadow-sm"
		style="background-color: LightGray;">
		<img src="./statics/img/youtbue.png"
			style="width: 40px; height: 30px;">
		<h5 class="my-0 mr-md-auto font-weight-normal">OOO保險公司</h5>
		<nav class="my-2 my-md-0 mr-md-3">
			<a class="p-2 text-dark" href="myMember.html">會員中心</a> <a
				class="p-2 text-dark" href="insurance.html">保險列表</a> <a
				class="p-2 text-dark" href="insurancePolicyView_Member.html">保單列表</a>
		</nav>
		<a class="btn btn-outline-primary" href="login.html">登出</a>
	</div>

	<div class="progress"
		style="weight: 100px; height: 30px; border-radius: 20px">
		<div class="progress-bar"
			style="width: 70%; height: 30px; border-radius: 20px">
			<h5 class="text-light-50" style="font-family: Microsoft JhengHei;">已完成保險資訊確認</h5>
		</div>
	</div>

	<div
		class="pricing-header px-3 py-1 pt-md-2 pb-md-2 mx-auto text-center bg-light"
		style="font-family: DFKai-sb;">
		<h4 class="display-4">受益人資訊輸入</h4>
		<p class="lead">請輸入受益人相關資訊</p>
	</div>

	<div class="bg-img"
		style="background-image: url('statics/img/caption.jpg'); background-repeat: no-repeat; background-attachment: fixed; background-size: cover;">
		<div class="container">
			<div class="py-5">
				<div style="background-color: #dedde280; border-radius: 10px;">

					<h4 class="mb-3">受益人資訊</h4>
					<hr class="mb-4">

					<div class="col-md-6 mb-3 ">
						<label for="name">受益人姓名</label><br /> <input id="name"
							type="text" class="form-control" maxlength="10" placeholder="王小明"
							required>
					</div>

					<div class="col-md-4 mb-3">
						<label for="relation">和要保人關係</label><br /> <input id="relation"
							type="text" class="form-control" maxlength="10" placeholder="父子"
							required>
					</div>

					<div class="col-md-6 mb-3">
						<label for="phonenum">手機號碼</label><br /> <input id="phonenum"
							type="tel" class="form-control" maxlength="20"
							placeholder="09xx-xxx-xxx" required>
					</div>

					<div class="col-md-10 mb-3">
						<label for="address">住址</label> <input type="text"
							class="form-control" id="address" maxlength="255"
							placeholder="請輸入有效之地址！" required>
					</div>


					<div class="d-grid gap-2 col-6 mx-auto">
						<a id="check" class="btn btn-primary btn-lg btn-block"
							type="button" href="order.html">送出資料</a>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>
	//	var member_id = localstorage.getItem("member_id");
		var member_id = "A123456789";
		//取得網址參數
		var url_string = window.location.href;
		var url = new URL(url_string);
		var insurance_id = parseInt(url.searchParams.get("insurance_id"), 10);
		var insurance_premium = parseInt(url.searchParams.get("insurance_premium"),10);

		$("#check").click(function() {
			var beneficiary = {
				"name" : $("#name").val(),
				"relation" : $("#relation").val(),
				"address" : $("#address").val(),
				"phone" : $("#phonenum").val()
			}

			if (validData(beneficiary)) {

				var data_object = {
					"member_id" : member_id,
					"insurance_id" : insurance_id,
					"insurance_premium" : insurance_premium,
					"beneficiary_name" : beneficiary["name"],
					"beneficiary_relationship" : beneficiary["relation"],
					"beneficiary_phone_number" : beneficiary["phone"],
					"beneficiary_address" : beneficiary["address"],
					"status" : 2
				};
				
				// 將JSON格式轉換成字串
                var data_string = JSON.stringify(data_object);

				var success = create(data_string);
				if(success == true)
					return true;
				else
					return false;
			} else {
				return false;
			}
		})

		function create(data_string) {
			$.ajax({
				type : "Post",
				url : "api/insurancePolicy.do",
				data : data_string,
				crossDomain : true,
				cache : false,
				dataType : 'json',
				timeout : 5000,
				success : function(response) {
					if (response.status == 200) {
						alert("成功建立保單!")
						return true
					}
				},
				error : function() {
					alert("無法連線到伺服器！");
					return false
				}
			})
		}

		function validData(data) {
			var phone_rule = /^09\d{2}-\d{3}-\d{3}$/;

			if (data["phone"] == "" || data['name'] == ""
					|| data['relation'] == "" || data["address"] == "")
				alert("必填寫欄位不得有空值！");
			else if (!phone_rule.test(data['phone']))
				alert("手機格式不符（應為09XX-XXX-XXX）！");
			else
				return true;

			return false;
		}
	</script>



</body>
</html>